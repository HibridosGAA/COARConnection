
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión / Registrarse</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    
    <div class="form-container">

        <!-- ESTRUCTURA DE PESTAÑAS -->
        <div class="tabs">
            <!-- Pestaña de Iniciar Sesión -->
            <div class="tab-button active" id="login-tab">
                Iniciar sesión
            </div>
            <!-- Pestaña de Registrarse -->
            <div class="tab-button" id="register-tab">
                Registrarse
            </div>
        </div>

        <!-- CONTENIDO DE INICIO DE SESIÓN (ACTIVO POR DEFECTO) -->
        <div id="login-content">
            
            <form method="POST" action="{{ url_for('login') }}">
                
                {# Los mensajes flash (errores o éxito) se mostrarán aquí #}
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="flash-message flash-{{ category }}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                <!-- Correo electrónico o nombre de usuario -->
                <div class="input-group">
                    <label for="login_username">Correo electrónico o nombre de usuario</label>
                    <input type="text" id="login_username" name="username" required>
                </div>
                
                <!-- Contraseña -->
                <div class="input-group">
                    <label for="login_password">Contraseña</label>
                    <input type="password" id="login_password" name="password" required>
                </div>
                
                <div class="forgot-password">
                    <a href="#">¿Olvidaste la contraseña?</a>
                </div>
                
                <button type="submit">Iniciar sesión</button>
            </form>
        </div>
        
        <!-- CONTENIDO DEL FORMULARIO DE REGISTRO (OCULTO POR DEFECTO) -->
        <div id="register-content" style="display: none;">
             <form method="POST" action="{{ url_for('register') }}">
                
                {# Los mensajes flash de la acción de registro se mostrarán aquí #}
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            {% if category == 'error' or category == 'success' %}
                                <div class="flash-message flash-{{ category }}">
                                    {{ message }}
                                </div>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <div class="input-group">
                    <label for="register_username">Nombre de usuario</label>
                    <input type="text" id="register_username" name="username" required>
                </div>
                
                <div class="input-group">
                    <label for="register_password">Contraseña</label>
                    <input type="password" id="register_password" name="password" required>
                </div>
                
                <!-- Nota: Las reglas de contraseña se pueden añadir aquí como texto rojo -->
                <p class="flash-error" style="font-size: 0.8em; text-align: left; margin-top: -10px;">
                    Tu contraseña debe tener entre 8 y 32 caracteres e incluir al menos una letra minúscula, una letra mayúscula, y un carácter especial.
                </p>
                
                <button type="submit">Registrarse</button>
            </form>
        </div>

    </div>

    <!-- Script para el manejo visual y de estado de pestañas -->
    <script>
        const registerTab = document.getElementById('register-tab');
        const loginTab = document.getElementById('login-tab');
        const registerContent = document.getElementById('register-content');
        const loginContent = document.getElementById('login-content');

        // Determinar si hay un mensaje flash y de qué categoría
        const flashMessage = document.querySelector('.flash-message');
        const isErrorFlash = flashMessage && flashMessage.classList.contains('flash-error');

        // Función para cambiar la pestaña activa (visual)
        function setActiveTab(active, inactive) {
            active.classList.add('active');
            inactive.classList.remove('active');
        }

        // Función para mostrar el contenido
        function showContent(show, hide) {
            show.style.display = 'block';
            hide.style.display = 'none';
        }

        // Manejadores de eventos para cambiar pestañas
        loginTab.addEventListener('click', () => {
            setActiveTab(loginTab, registerTab);
            showContent(loginContent, registerContent);
        });

        registerTab.addEventListener('click', () => {
            setActiveTab(registerTab, loginTab);
            showContent(registerContent, loginContent);
        });
        
        // Inicialización: Decide qué pestaña mostrar al cargar la página
        if (flashMessage) {
            // Si hay un error, asumimos que fue en la última acción (registro) y cambiamos a la pestaña de registro.
            if (isErrorFlash) {
                setActiveTab(registerTab, loginTab);
                showContent(registerContent, loginContent);
            } else {
                // Si es un mensaje de éxito (ej: "Cuenta creada"), nos movemos a la pestaña de login.
                setActiveTab(loginTab, registerTab);
                showContent(loginContent, registerContent);
            }
        } else {
             // Por defecto, iniciamos en la pestaña de login
             setActiveTab(loginTab, registerTab);
             showContent(loginContent, registerContent);
        }
    </script>
</body>
</html>
